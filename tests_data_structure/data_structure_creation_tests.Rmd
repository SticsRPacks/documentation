---
title: "data_structure"
output: html_document
---

```{r setup, include=FALSE}
options(tinytex.verbose = TRUE)
knitr::opts_chunk$set(echo = TRUE)
```

# Description

In this document, are the tests concerning the creation of different data structure and their filling.
We have 5 types, a list composed of objects, a class which has a list composed of objects, a data frame
based on an object and composed of an objects' list, a tibble based on a data frame and composed of
an objects' list and a data table also based on a data frame and composed of an objects' list.

The tests consist in filling these structures, in the purpose that they will contain 10K, 100K or 1M
objects.

Each object is composed of a name (character), a beginning and end date (numeric), a xml document (character),
a ground_name (character),a fstation (character),a fclim1 (character),a fclim2 (character),
a culturean (numeric), a number of plant (numeric), a simulation code (numeric), a data's list for the
first dominant plant (character) and the same goes for the second dominant plant, an observation file (character)
and the last is an element list that can be modify as we want.

The dominant plants lists are composed of a fplt (character), a ftec (character) and a flai (character)

There are 3 types of test. The first is a non pre-allocated list, the second is a pre-allocated 
vector and the last one is a pre-allocated list using the lapply method.

# Constructors

````{r constructors}
## functions file
source("data_structure_functions.R")

########################### LIBRARIES & GLOBAL VARIABLES/FUNCTIONs ################################
library(microbenchmark)
library(ggplot2)
library(tibble)
library(data.table)
library(dplyr)

# microbenchmark execution number
time = 100                                                                

# function that creates a 300 elem long list of elements that can be modified
num_list = function() {
  li <- lapply(1:300,function(i) i)
  return(li)
}

############################### LIST ##############################

# "plant dominance 1" list creation
pld_sugarCane1 = list("fplt" = "proto_sugarcane_plt.xml","ftec" = "canne_tec.xml","flai" = "null") 

# "plant dominance 2" list creation
pld_sugarCane2 = list("fplt" = "null","ftec" = "null","flai" = "null")     
 
# 300 elem long list which can be modified
elem_list = num_list()                                                                               

# sugarCane usm creation
usm_sugarCane <- list(name = "SugarCane",date_begin = 286,date_end = 650,finit = "canne_ini.xml",
                      ground_name = "solcanne",fstation = "climcanj_sta.xml",fclim1 = "climcanj.1998",
                      fclim2 = "climcanj.1999",culturean = 0,nb_plant = 1,simulation_code = 0,
                      plant_dominance_1 = pld_sugarCane1,plant_dominance_2 = pld_sugarCane2,
                      observation_file = "file.obs",elements_list = elem_list) 



############################# CLASS ########################################

# usm class declaration
usm <- setRefClass("usm",
                   fields = list(name = "character",date_begin = "numeric",date_end = "numeric",
                                 finit = "character",ground_name = "character",fstation = "character",
                                 fclim1 = "character",fclim2 = "character",culturean = "numeric",
                                 nb_plant = "numeric",simulation_code = "numeric",
                                 plant_dominance_1 = "list",plant_dominance_2 = "list",
                                 observation_file = "character",elements_list = "list")
)

# usm class object Sugarcane instanciation
Sugarcane <- usm(name = "SugarCane",date_begin = 286,date_end = 650,finit = "canne_ini.xml",
                 ground_name = "solcanne",fstation = "climcanj_sta.xml",fclim1 = "climcanj.1998",
                 fclim2 = "clilmcanj.1999",nb_plant = 0,simulation_code = 1,
                 plant_dominance_1 = pld_sugarCane1,plant_dominance_2 = pld_sugarCane2,
                 observation_file = "file.obs",elements_list = elem_list)


################ DATA FRAME ################################################

# creation data frame df using list usm_sugarCane
df <- data.frame(usm_sugarCane)

############### TIBBLE #####################################################

#creation tibble tb using data frame df
tb <- tibble::as_tibble(df)

############## DATA TABLE #############

#creation data table using data frame df
dt <- data.table(df)

## number of element
num_elem = 10000
```

# Tests

```{r tests list 10K}

test <- NPA_list(num_elem,usm_sugarCane)

#OST stands for Object Size Test
ost1 <- object.size(test)

test <- PA_vector_list_and_class(num_elem,usm_sugarCane)
ost2 <- object.size(test)

test <- PA_List_list_and_class(num_elem,usm_sugarCane)
ost3 <- object.size(test)

plot_df <- data.frame(tests = c("NPA list","PA Vector","lapply"),
                      weight = c(ost1,ost2,ost3))

graph <- ggplot(data = plot_df,aes(x = tests, y=weight)) + geom_bar(stat = "identity")
graph + ggtitle(sprintf("%d %s",num_elem," elements List"))

 
min_weight_li_10 <- ost1

test_plot = microbenchmark(NPA_list(num_elem,usm_sugarCane),
                           PA_vector_list_and_class(num_elem,usm_sugarCane),
                           PA_List_list_and_class(num_elem,usm_sugarCane),
                           times = time
)

plot_df <- data.frame(tests = c("NPA list","PA Vector","lapply"),
                      time_milliseconds = log10(c(16703,20.24,5.96)))
graph <- ggplot(data = plot_df,aes(x = tests, y=time_milliseconds)) + geom_bar(stat = "identity")
graph + ggtitle(sprintf("%d %s",num_elem," elements List"))

ggplot2::autoplot(test_plot) + ggtitle(sprintf("%s %d %s","Duration tests for a ",num_elem," elements List"))

```


```{r test class 10K}

########## CLASS ############
test <- NPA_list(num_elem,Sugarcane)
ost1 <- object.size(test)

test <- PA_vector_list_and_class(num_elem,Sugarcane)
ost2 <- object.size(test)

test <- PA_List_list_and_class(num_elem,Sugarcane)
ost3 <- object.size(test)

plot_df <- data.frame(tests = c("NPA list","PA Vector","lapply"),
                      weight = c(ost1,ost2,ost3))

graph <- ggplot(data = plot_df,aes(x = tests, y=weight)) + geom_bar(stat = "identity")
graph + ggtitle(sprintf("%d %s",num_elem," elements Class"))

min_weight_cl_10 <- ost1

test_plot = microbenchmark(NPA_list(num_elem,Sugarcane),
                           PA_vector_list_and_class(num_elem,Sugarcane),
                           PA_List_list_and_class(num_elem,Sugarcane),
                           times = time
)

plot_df <- data.frame(tests = c("NPA list","PA Vector","lapply"),
                      time_microseconds = c(411750,845,5949))
graph <- ggplot(data = plot_df,aes(x = tests, y=time_microseconds)) + geom_bar(stat = "identity")
graph + ggtitle(sprintf("%d %s",num_elem," elements Class"))

ggplot2::autoplot(test_plot)  + ggtitle(sprintf("%s %d %s","Duration tests for a ",num_elem," elements Class"))

```

```{r tests data frame 10K}

######### DATA FRAME ##########
test <- PA_vector_Df_and_Tb(num_elem,df)
ost2 <- object.size(test)

test <- PA_List_Df_and_Tb(num_elem,df)
ost3 <- object.size(test)

plot_df <- data.frame(tests = c("PA Vector","lapply"),
                      weight = c(ost2,ost3))

graph <- ggplot(data = plot_df,aes(x = tests, y=weight)) + geom_bar(stat = "identity")
graph + ggtitle(sprintf("%d %s",num_elem," elements DataFrame"))

min_weight_df_10 <- ost2

test_plot = microbenchmark(PA_vector_Df_and_Tb(num_elem,df),
                           PA_List_Df_and_Tb(num_elem,df),
                           times = time
)

plot_df <- data.frame(tests = c("PA Vector","lapply"),
                      time_milliseconds = c(363,346))
graph <- ggplot(data = plot_df,aes(x = tests, y=time_milliseconds)) + geom_bar(stat = "identity")
graph + ggtitle(sprintf("%d %s",num_elem," elements DataFrame"))

ggplot2::autoplot(test_plot)  + ggtitle(sprintf("%s %d %s","Duration tests for a ",num_elem," elements DataFrame"))

```

```{r tests tibble 10K}

######### TIBBLE ##############

test <- PA_vector_Df_and_Tb(num_elem,tb)
ost2 <- object.size(test)

test <- PA_List_Df_and_Tb(num_elem,tb)
ost3 <- object.size(test)

plot_df <- data.frame(tests = c("PA Vector","lapply"),
                      weight = c(ost2,ost3))

graph <- ggplot(data = plot_df,aes(x = tests, y=weight)) + geom_bar(stat = "identity")
graph + ggtitle(sprintf("%d %s",num_elem," elements Tibble"))

min_weight_tb_10 <- ost2

test_plot = microbenchmark(PA_vector_Df_and_Tb(num_elem,tb),
                           PA_List_Df_and_Tb(num_elem,tb),
                           times = time
)

plot_df <- data.frame(tests = c("PA Vector","lapply"),
                      time_milliseconds = c(365,349))
graph <- ggplot(data = plot_df,aes(x = tests, y=time_milliseconds)) + geom_bar(stat = "identity")
graph + ggtitle(sprintf("%d %s",num_elem," elements Tibble"))

ggplot2::autoplot(test_plot)  + ggtitle(sprintf("%s %d %s","Duration tests for a ",num_elem," elements Tibble"))

```

```{r data table 10k}

################ DATA TABLE #########################

test <- PA_vector_Df_and_Tb(num_elem,dt)
ost2 <- object.size(test)

test <- PA_List_Df_and_Tb(num_elem,dt)
ost3 <- object.size(test)

plot_df <- data.frame(tests = c("PA Vector","lapply"),
                      weight = c(ost2,ost3))

graph <- ggplot(data = plot_df,aes(x = tests, y=weight)) + geom_bar(stat = "identity")
graph + ggtitle(sprintf("%d %s",num_elem," elements DataTable"))

min_weight_dt_10 <- ost2

test_plot = microbenchmark(PA_vector_Df_and_Tb(num_elem,dt),
                           PA_List_Df_and_Tb(num_elem,dt),
                           times = time
)

plot_df <- data.frame(tests = c("PA Vector","lapply"),
                      time_milliseconds = c(367,353))
graph <- ggplot(data = plot_df,aes(x = tests, y=time_milliseconds)) + geom_bar(stat = "identity")
graph + ggtitle(sprintf("%d %s",num_elem," elements DataTable"))

ggplot2::autoplot(test_plot)  + ggtitle(sprintf("%s %d %s","Duration tests for a ",num_elem," elements DataTable"))

```

#Recap
```{r recap 10K}

plot_df_recap <- data.frame(structures = c("list","Class","DataFrame","Tibble","DataTable"),
                      weight_log10 = log10(c(min_weight_li_10,min_weight_cl_10,min_weight_df_10,min_weight_tb_10,min_weight_dt_10)))

graph_recap <- ggplot(data = plot_df_recap,aes(x = structures, y=weight_log10)) + geom_bar(stat = "identity")
graph_recap + ggtitle(sprintf("%d %s",num_elem," elements structures"))

recap_test = microbenchmark(PA_List_list_and_class(num_elem,usm_sugarCane),
                            PA_vector_list_and_class(num_elem,Sugarcane),
                            PA_List_Df_and_Tb(num_elem,df),
                            PA_List_Df_and_Tb(num_elem,tb),
                            PA_List_Df_and_Tb(num_elem,dt),
                            times = time
)

plot_df <- data.frame(tests = c("List","Class","Data Frame","Tibble","DataTable"),
                      time_microseconds = log10(c(5960,845,346000,349000,353000)))
graph <- ggplot(data = plot_df,aes(x = tests, y=time_microseconds)) + geom_bar(stat = "identity")
graph + ggtitle(sprintf("%d %s",num_elem," elements Structures"))

ggplot2::autoplot(recap_test) + ggtitle("Time recap")


```

```{r tests list 100K}
num_elem = num_elem * 10

# This takes too much time 
# test <- NPA_list(num_elem,usm_sugarCane)
# ost1 <- object.size(test)

test <- PA_vector_list_and_class(num_elem,usm_sugarCane)
ost2 <- object.size(test)

test <- PA_List_list_and_class(num_elem,usm_sugarCane)
ost3 <- object.size(test)

min_weight_li_100 <- ost2

plot_df <- data.frame(tests = c("PA Vector","lapply"),
                      weight = c(ost2,ost3))

graph <- ggplot(data = plot_df,aes(x = tests, y=weight)) + geom_bar(stat = "identity")
graph + ggtitle(sprintf("%d %s",num_elem," elements List"))

test_plot = microbenchmark(PA_vector_list_and_class(num_elem,usm_sugarCane),
                           PA_List_list_and_class(num_elem,usm_sugarCane),
                           times = time
)

plot_df <- data.frame(tests = c("PA Vector","lapply"),
                      time_milliseconds = c(201,62))
graph <- ggplot(data = plot_df,aes(x = tests, y=time_milliseconds)) + geom_bar(stat = "identity")
graph + ggtitle(sprintf("%d %s",num_elem," elements List"))

ggplot2::autoplot(test_plot) + ggtitle(sprintf("%s %d %s","Duration tests for a ",num_elem," elements List"))

```


```{r test class 100K}

########## CLASS ############

test <- NPA_list(num_elem,Sugarcane)
ost1 <- object.size(test)

test <- PA_vector_list_and_class(num_elem,Sugarcane)
ost2 <- object.size(test)

test <- PA_List_list_and_class(num_elem,Sugarcane)
ost3 <- object.size(test)

plot_df <- data.frame(tests = c("NPA list","PA Vector","lapply"),
                      weight = c(ost1,ost2,ost3))

graph <- ggplot(data = plot_df,aes(x = tests, y=weight)) + geom_bar(stat = "identity")
graph + ggtitle(sprintf("%d %s",num_elem," elements Class"))

min_weight_cl_100 <- ost1

test_plot = microbenchmark(NPA_list(num_elem,Sugarcane),
                           PA_vector_list_and_class(num_elem,Sugarcane),
                           PA_List_list_and_class(num_elem,Sugarcane),
                           times = time
)

plot_df <- data.frame(tests = c("NPA list","PA Vector","lapply"),
                      time_milliseconds = log10(c(39641,8.35,63)))
graph <- ggplot(data = plot_df,aes(x = tests, y=time_milliseconds)) + geom_bar(stat = "identity")
graph + ggtitle(sprintf("%d %s",num_elem," elements Class"))

ggplot2::autoplot(test_plot)  + ggtitle(sprintf("%s %d %s","Duration tests for a ",num_elem," elements Class"))

```

```{r tests data frame 100K}

######### DATA FRAME ##########
test <- PA_vector_Df_and_Tb(num_elem,df)
ost2 <- object.size(test)

test <- PA_List_Df_and_Tb(num_elem,df)
ost3 <- object.size(test)

plot_df <- data.frame(tests = c("PA Vector","lapply"),
                      weight = c(ost2,ost3))

graph <- ggplot(data = plot_df,aes(x = tests, y=weight)) + geom_bar(stat = "identity")
graph + ggtitle(sprintf("%d %s",num_elem," elements DataFrame"))

min_weight_df_100 <- ost2

test_plot = microbenchmark(PA_vector_Df_and_Tb(num_elem,df),
                           PA_List_Df_and_Tb(num_elem,df),
                           times = time
)

plot_df <- data.frame(tests = c("PA Vector","lapply"),
                      time_seconds = c(3.74,3.57))
graph <- ggplot(data = plot_df,aes(x = tests, y=time_seconds)) + geom_bar(stat = "identity")
graph + ggtitle(sprintf("%d %s",num_elem," elements DataFrame"))

ggplot2::autoplot(test_plot)  + ggtitle(sprintf("%s %d %s","Duration tests for a ",num_elem," elements DataFrame"))

```

```{r tests tibble 100K}

######### TIBBLE ##############

num_elem = num_elem * 10

test <- PA_vector_Df_and_Tb(num_elem,tb)
ost2 <- object.size(test)

test <- PA_List_Df_and_Tb(num_elem,tb)
ost3 <- object.size(test)

plot_df <- data.frame(tests = c("PA Vector","lapply"),
                      weight = c(ost2,ost3))

graph <- ggplot(data = plot_df,aes(x = tests, y=weight)) + geom_bar(stat = "identity")
graph + ggtitle(sprintf("%d %s",num_elem," elements Tibble"))

min_weight_tb_100 <- ost2

test_plot = microbenchmark(PA_vector_Df_and_Tb(num_elem,tb),
                           PA_List_Df_and_Tb(num_elem,tb),
                           times = time
)

plot_df <- data.frame(tests = c("PA Vector","lapply"),
                      time_seconds = c(3.73,3.57))
graph <- ggplot(data = plot_df,aes(x = tests, y=time_seconds)) + geom_bar(stat = "identity")
graph + ggtitle(sprintf("%d %s",num_elem," elements Tibble"))

ggplot2::autoplot(test_plot)  + ggtitle(sprintf("%s %d %s","Duration tests for a ",num_elem," elements Tibble"))

```


```{r data table 100k}

################ DATA TABLE #########################

test <- PA_vector_Df_and_Tb(num_elem,dt)
ost2 <- object.size(test)

test <- PA_List_Df_and_Tb(num_elem,dt)
ost3 <- object.size(test)

plot_df <- data.frame(tests = c("PA Vector","lapply"),
                      weight = c(ost2,ost3))

graph <- ggplot(data = plot_df,aes(x = tests, y=weight)) + geom_bar(stat = "identity")
graph + ggtitle(sprintf("%d %s",num_elem," elements DataTable"))

min_weight_dt_100 <- ost2

test_plot = microbenchmark(PA_vector_Df_and_Tb(num_elem,dt),
                           PA_List_Df_and_Tb(num_elem,dt),
                           times = time
)

plot_df <- data.frame(tests = c("PA Vector","lapply"),
                      time_seconds = c(3.88,3.72))
graph <- ggplot(data = plot_df,aes(x = tests, y=time_seconds)) + geom_bar(stat = "identity")
graph + ggtitle(sprintf("%d %s",num_elem," elements DataTable"))

ggplot2::autoplot(test_plot)  + ggtitle(sprintf("%s %d %s","Duration tests for a ",num_elem," elements DataTable"))

```

#Recap

```{r recap 100K}

plot_df_recap <- data.frame(structures = c("List","Class","DataFrame","Tibble","DataTable"),
                      weight_log10 = log10(c(min_weight_li_100,min_weight_cl_100,min_weight_df_100,min_weight_tb_100,min_weight_dt_100)))

graph_recap <- ggplot(data = plot_df_recap,aes(x = structures, y=weight_log10)) + geom_bar(stat = "identity")
graph_recap + ggtitle(sprintf("%d %s",num_elem," elements structures"))

recap_test = microbenchmark(PA_List_list_and_class(num_elem,usm_sugarCane),
                            PA_vector_list_and_class(num_elem,Sugarcane),
                            PA_List_Df_and_Tb(num_elem,df),
                            PA_List_Df_and_Tb(num_elem,tb),
                            PA_List_Df_and_Tb(num_elem,dt),
                            times = time
)

plot_df <- data.frame(tests = c("List","Class","DataFrame","Tibble","DataTable"),
                      time_milliseconds = log10(c(62,8.35,3570,3570,3720)))
graph <- ggplot(data = plot_df,aes(x = tests, y=time_milliseconds)) + geom_bar(stat = "identity")
graph + ggtitle(sprintf("%d %s",num_elem," elements Structures"))

ggplot2::autoplot(recap_test) + ggtitle("Time recap")
```

```{r tests list 1M}
num_elem = num_elem * 10

# this takes too much time 
# test <- NPA_list(num_elem,usm_sugarCane)
# ost1 <- object.size(test)

test <- PA_vector_list_and_class(num_elem,usm_sugarCane)
ost2 <- object.size(test)

test <- PA_List_list_and_class(num_elem,usm_sugarCane)
ost3 <- object.size(test)

min_weight_li_1m = ost3

plot_df <- data.frame(tests = c("PA Vector","lapply"),
                      weight = c(ost2,ost3))

graph <- ggplot(data = plot_df,aes(x = tests, y=weight)) + geom_bar(stat = "identity")
graph + ggtitle(sprintf("%d %s",num_elem," elements List"))

test_plot = microbenchmark(PA_vector_list_and_class(num_elem,usm_sugarCane),
                           PA_List_list_and_class(num_elem,usm_sugarCane),
                           times = time
)

plot_df <- data.frame(tests = c("PA Vector","lapply"),
                      time_milliseconds = c(1982,590))
graph <- ggplot(data = plot_df,aes(x = tests, y=time_milliseconds)) + geom_bar(stat = "identity")
graph + ggtitle(sprintf("%d %s",num_elem," elements List"))

ggplot2::autoplot(test_plot) + ggtitle(sprintf("%s %d %s","Duration tests for a ",num_elem," elements List"))

```


```{r test class 1M}

########## CLASS ############

# this takes too much time
# test <- NPA_list(num_elem,Sugarcane)
# ost1 <- object.size(test)

test <- PA_vector_list_and_class(num_elem,Sugarcane)
ost2 <- object.size(test)

test <- PA_List_list_and_class(num_elem,Sugarcane)
ost3 <- object.size(test)

plot_df <- data.frame(tests = c("PA Vector","lapply"),
                      weight = c(ost2,ost3))

graph <- ggplot(data = plot_df,aes(x = tests, y=weight)) + geom_bar(stat = "identity")
graph + ggtitle(sprintf("%d %s",num_elem," elements Class"))

min_weight_cl_1m <- ost2

test_plot = microbenchmark(PA_vector_list_and_class(num_elem,Sugarcane),
                           PA_List_list_and_class(num_elem,Sugarcane),
                           times = time
)

plot_df <- data.frame(tests = c("PA Vector","lapply"),
                      time_milliseconds = c(83,623))
graph <- ggplot(data = plot_df,aes(x = tests, y=time_milliseconds)) + geom_bar(stat = "identity")
graph + ggtitle(sprintf("%d %s",num_elem," elements Class"))

ggplot2::autoplot(test_plot)  + ggtitle(sprintf("%s %d %s","Duration tests for a ",num_elem," elements Class"))

```

```{r tests data frame 1M}

######### DATA FRAME ##########

num_elem = 1000000

test <- PA_vector_Df_and_Tb(num_elem,df)
ost2 <- object.size(test)

test <- PA_List_Df_and_Tb(num_elem,df)
ost3 <- object.size(test)

plot_df <- data.frame(tests = c("PA Vector","lapply"),
                      weight = c(ost2,ost3))

graph <- ggplot(data = plot_df,aes(x = tests, y=weight)) + geom_bar(stat = "identity") 
graph + ggtitle(sprintf("%d %s",num_elem," elements DataFrame"))

min_weight_df_1m <- ost2

test_plot = microbenchmark(PA_vector_Df_and_Tb(num_elem,df),
                           PA_List_Df_and_Tb(num_elem,df),
                           times = time
)

plot_df <- data.frame(tests = c("PA Vector","lapply"),
                      time_seconds = c(37,35))
graph <- ggplot(data = plot_df,aes(x = tests, y=time_seconds)) + geom_bar(stat = "identity")
graph + ggtitle(sprintf("%d %s",num_elem," elements DataFrame"))

ggplot2::autoplot(test_plot)  + ggtitle(sprintf("%s %d %s","Duration tests for a ",num_elem," elements DataFrame"))

```


```{r tests tibble 1M}

######### TIBBLE ##############

test <- PA_vector_Df_and_Tb(num_elem,tb)
ost2 <- object.size(test)

test <- PA_List_Df_and_Tb(num_elem,tb)
ost3 <- object.size(test)

plot_df <- data.frame(tests = c("PA Vector","lapply"),
                      weight = c(ost2,ost3))

graph <- ggplot(data = plot_df,aes(x = tests, y=weight)) + geom_bar(stat = "identity")
graph + ggtitle(sprintf("%d %s",num_elem," elements Tibble"))

min_weight_tb_1m <- ost2

test_plot = microbenchmark(PA_vector_Df_and_Tb(num_elem,tb),
                           PA_List_Df_and_Tb(num_elem,tb),
                           times = time
)

plot_df <- data.frame(tests = c("PA Vector","lapply"),
                      time_seconds = c(36,34))
graph <- ggplot(data = plot_df,aes(x = tests, y=time_seconds)) + geom_bar(stat = "identity")
graph + ggtitle(sprintf("%d %s",num_elem," elements Tibble"))

ggplot2::autoplot(test_plot)  + ggtitle(sprintf("%s %d %s","Duration tests for a ",num_elem," elements Tibble"))

```


```{r data table 1M}

################ DATA TABLE #########################

test <- PA_vector_Df_and_Tb(num_elem,dt)
ost2 <- object.size(test)

test <- PA_List_Df_and_Tb(num_elem,dt)
ost3 <- object.size(test)

plot_df <- data.frame(tests = c("PA Vector","lapply"),
                      weight = c(ost2,ost3))

graph <- ggplot(data = plot_df,aes(x = tests, y=weight)) + geom_bar(stat = "identity")
graph + ggtitle(sprintf("%d %s",num_elem," elements DataTable"))

min_weight_dt_1m <- ost2

test_plot = microbenchmark(PA_vector_Df_and_Tb(num_elem,dt),
                           PA_List_Df_and_Tb(num_elem,dt),
                           times = time
)

plot_df <- data.frame(tests = c("PA Vector","lapply"),
                      time_seconds = c(34,33))
graph <- ggplot(data = plot_df,aes(x = tests, y=time_seconds)) + geom_bar(stat = "identity")
graph + ggtitle(sprintf("%d %s",num_elem," elements DataTable"))

ggplot2::autoplot(test_plot)  + ggtitle(sprintf("%s %d %s","Duration tests for a ",num_elem," elements DataTable"))

```

#Recap

```{r recap 1M}

plot_df_recap <- data.frame(structures = c("List","Class","DataFrame","Tibble","DataTable"),
                      weight_log10 = log10(c(min_weight_li_1m,min_weight_cl_1m,min_weight_df_1m,min_weight_tb_1m,min_weight_dt_1m)))


graph_recap <- ggplot(data = plot_df_recap,aes(x = structures, y=weight_log10)) + 
               geom_bar(stat = "identity")
graph_recap + ggtitle(sprintf("%d %s",num_elem," elements structures"))

recap_test <- microbenchmark(PA_List_list_and_class(num_elem,Sugarcane),
                            PA_List_Df_and_Tb(num_elem,df),
                            PA_List_Df_and_Tb(num_elem,tb),
                            PA_List_Df_and_Tb(num_elem,dt),
                            times = time
)

plot_df <- data.frame(tests = c("List","Class","DataFrame","Tibble","DataTable"),
                      time_milliseconds = log10(c(590,83,35000,34000,33000)))
graph <- ggplot(data = plot_df,aes(x = tests, y=time_milliseconds)) + geom_bar(stat = "identity")
graph + ggtitle(sprintf("%d %s",num_elem," elements Structures"))

ggplot2::autoplot(recap_test) + ggtitle("Time recap")
```

```{r final recap}

plot_df_recap_weight <- data.frame(structures = c("Class","DataFrame","Tibble","DataTable","Class","DataFrame","Tibble","DataTable","Class","DataFrame","Tibble","DataTable"),
                      weight_log10 = log10(c(min_weight_cl_10,min_weight_df_10,min_weight_tb_10,min_weight_dt_10,
                                 min_weight_cl_100,min_weight_df_100,min_weight_tb_100,min_weight_dt_100,
                                 min_weight_cl_1m,min_weight_df_1m,min_weight_tb_1m,min_weight_dt_1m)),
                      size = c("10 000","10 000","10 000","10 000",
                               "100 000","100 000","100 000","100 000",
                               "1 000 000","1 000 000","1 000 000","1 000 000"))

graph_recap_weight <- ggplot(data = plot_df_recap_weight,aes(x = size, y=weight_log10, fill = structures)) + 
               geom_bar(stat = "identity", position = "dodge")
graph_recap_weight + ggtitle(sprintf("%d %s",num_elem," elements structures"))

plot_df_recap_time <- data.frame(structures = c("List","Class","DataFrame","Tibble","DataTable","List","Class","DataFrame","Tibble","DataTable","List","Class","DataFrame","Tibble","DataTable"),
                      time_microseconds_log10 = log10(c(5960,845,346000,349000,353000,62000,8350,3570000,3570000,3720000,590000,83000,35000000,34000000,33000000)),
                      size = c("10 000","10 000","10 000","10 000","10 000",
                               "100 000","100 000","100 000","100 000","100 000",
                               "1 000 000","1 000 000","1 000 000","1 000 000","1 000 000"))

graph_recap_time <- ggplot(data = plot_df_recap_time,aes(x = size, y=time_microseconds_log10, fill = structures)) + 
               geom_bar(stat = "identity", position = "dodge")
graph_recap_time + ggtitle(sprintf("%d %s",num_elem," elements structures"))

```