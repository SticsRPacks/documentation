---
title: "data_structure"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      cache = TRUE,
                      cache.lazy = TRUE,
                      warn = -1)
source("data_structure_functions.R")
library(tibble)
library(data.table)
library(tidyverse)
library(microbenchmark)
library(dplyr)
library(ggplot2)
library(memuse)
library(lobstr)

# list which store the differents instances' size
num_elem <- c(1000,10000,100000)
options(warn=-1)
```

# I. Introduction 

In order to boost the program, we want to use a datatype structure that is light and robust, in 
order to contains the model's inputs (USMS).
What will follow in this document are the tests done in the purpose of determining the best datatype
structure suited for that.
The tests will concern the generation speed, the memory weight and the manipulation ease.

## I.A The Dataypes structures

Initially, they were 6 candidates :

- The List type
- The Reference Class type
- The DataFrame type
- The DataTable type
- The Tibble type
- The Matrix type

However, the Matrix type was the first one to be put away because it can only contains informations
with homogenous types (e.g only numeric or character but not numeric and character together). Or, an
USM is composed of :

- a name (character)
- a beginning date (numeric)
- an ending date (numeric)
- an initialisation file name (character)
- the ground name (character)
- a station file name (character)
- a first climate file name (character)
- a second climate file name (character)
- the year of culture (numeric)
- the number of plants (numeric)
- the simulation_code (numeric)
- informations about the first plant (3 informations(fplt,ftec,flai)) (character)
- informations about the second plant (same)
- the observation file name (character)

So here are examples of usm in the remaining datatypes.

### I.A.1 List

```{r example usm list}

example_usm_list <- usm_list("usm_1","sol_canne")
example_usm_list

```

### I.A.2 Class

```{r example usm class}
example_usm_class <- usm_class("usm_1","sol_canne")
example_usm_class

```

### I.A.3 DataFrame

```{r example usm dataframe}

example_usm_dataframe <- usm_dataframe("usm_1","sol_canne")
example_usm_dataframe

```

### I.A.4 DataTable

```{r example usm datatable}

example_usm_datatable <- usm_datatable("usm_1","sol_canne")
example_usm_datatable

```

### I.A.5 Tibble

```{r example usm tibble}

example_usm_tibble <- usm_tibble("usm_1","sol_canne")
example_usm_tibble

```

# II. Tests

The firsts tests to be made were instanciation tests. We tested the instanciation time and weight
for each datatype structure with different instanciation method and for differents sizes (10 000,
100 000, 1 000 000)

## II.A Instanciation Tests

### II.A.1 Non Pre-Allocated Vs Pre-Allocated

These tests were made for list and class types because only these two types can be instanciated
with a non pre-allocated method, which is not possible for the other types.

```{r npa vs pa}

# list which contains the structures' types
Structures_types <- c("list","class")
# times units
times_units <- c("nanoseconds","microseconds","milliseconds","seconds")
# get benchmark time unit, 
time_unit <- NULL
# graph legend dor time unit
time_ref <- NULL

times_list_NPA <- list()
times_list_PA <- list()
times_class_NPA <- list()
times_class_PA <- list()

weights_list <- list()
weights_class <- list()

# Loop on structures (List,Class)
for (i in Structures_types) {
  cat("\nStrucure : ",i,"\n")
  # Loop on size (10K,100K,1M)
  for (j in num_elem) {
    
    # first call to creation functions to get the structure weight for the j size
    set.seed(1) # setting seed to have the same object between list and class
    test <- eval(parse(text=paste("list_of_usm_",i,"_by_lapply(",j,")",sep="")))
    if (i == "list") {
      weights_list <- append(weights_list,object.size(test))
    }
    else {
      weights_class <- append(weights_class,object.size(test))
    }
    
    # benchmark
     benchmark <- microbenchmark(NPA_Lapply= eval(parse(text=paste("list_of_usm_",i,"_by_lapply(",j,")",sep=""))),
                                 PA_Lapply = eval(parse(text=paste("list_of_usm_",i,"_by_PA_lapply(",j,")",sep=""))),
                                 setup = set.seed(1),times = 100)
     
     if (is.null(time_unit)) {
       time_unit =  unit_str <- gsub(pattern = "Unit: ", x = capture.output(benchmark)[1], replacement = "")
     }
     
     current_bench_time_unit =  unit_str <- gsub(pattern = "Unit: ", x = capture.output(benchmark)[1], replacement = "")
     
     time_NPA = summary(benchmark)$median[1]
     time_PA = summary(benchmark)$median[2]
     
     if (current_bench_time_unit != time_unit) {
       index_time_unit = which(times_units == time_unit)
       index_current_bench_time_unit = which(times_units == current_bench_time_unit)
       diff = index_current_bench_time_unit - index_time_unit
       # we're starting from the hypothesis that the first unit will be the unit from the benchmark with the smallest size and a benchmark with a bigger size will take more time. We multiply by 1000 because it is the rate to pass from an unit to another.
       for (k in 1:diff) {
         time_NPA <- time_NPA*1000
         time_PA <- time_PA*1000
       }
     }
     
     if (i == "list") {
       if (j == 1000) {
         times_list_NPA <- time_NPA
         times_list_PA <- time_PA
       }
       else {
         times_list_NPA <- append(times_list_NPA,time_NPA)
         times_list_PA <- append(times_list_PA,time_PA)
       }
     }
     else {
       if (j == 1000) {
         times_class_NPA <- time_NPA
         times_class_PA <- time_PA
       }
       else {
         times_class_NPA <- append(times_class_NPA,time_NPA)
         times_class_PA <- append(times_class_PA,time_PA)
       }
     }
     
     if (j == 100000) {
       print(ggplot2::autoplot(benchmark))
     }
  }
  time_ref <- paste("Time_log10_",time_unit,sep="")
  if (i == "list") {
    df_NPA <- data.frame(Usms = num_elem, time_ref = log10(times_list_NPA), type = "NPA")
    df_PA <- data.frame(Usms = num_elem, time_ref = log10(times_list_PA), type = "PA")
    final <- rbind(df_NPA,df_PA)
    ggplot(final)+geom_line(aes(Usms,time_ref,colour=type))
  }
  else {
    df_NPA <- data.frame(Usms = num_elem, time_ref = log10(times_class_NPA), type = "NPA")
    df_PA <- data.frame(Usms = num_elem, time_ref = log10(times_class_PA), type = "PA")
    final <- rbind(df_NPA,df_PA)
    ggplot(final)+geom_line(aes(Usms,time_ref,colour=type))
  }
}

df_list_weights <- data.frame(Usms = num_elem, Weights = weights_list, type = "List")
df_class_weights <- data.frame(Usms = num_elem, Weights = weights_class, type = "Class")
final_weights <- rbind(df_list_weights,df_class_weights)
ggplot(final_weights)+geom_line(aes(Usms,Weights,colour=type))

df_list_time <- data.frame(Usms = num_elem, time_ref = log10(times_list_NPA), type = "NPA List")
df_class_time <- data.frame(Usms = num_elem, time_ref = log10(times_class_NPA), type = "NPA Class")
final_time <- rbind(df_list_time,df_class_time)
ggplot(final_time)+geom_line(aes(Usms,time_ref,colour=type))
```

Even, if the NPA instanciation is 'lighter' than the others, its huge instanciation time makes that we will not use it. Indeed, during the tests, we must divide by hundred the number of usm the NPA contains because it will last more tha 3 days before it creates a 1M usms structure. 

### II.A.2 DataFrame, DataTable and Tibble

Now, let's move on to the tests involving the DataFrame,DataTable and Tibble instanciation methods.
Indeed, they are severals ways to instanciate each of these types. 
DataFrame : By affecting list in a dataframe's row or by row binding a list of dataframe.
DataTable : Doing the same as before but for a DataTable or by casting the DataFrame output into a 
DataTable.
Tibble : Same ways as for DataTable

``` {r df,dt,tb}

# list which contains the structures' types
Structures_types <- c("dataframe","datatable","tibble")
# times units
times_units <- c("nanoseconds","microseconds","milliseconds","seconds")
# get benchmark time unit, 
time_unit <- NULL
# graph legend dor time unit
time_ref <- NULL

times_dataframe <- list()
times_dataframe_lapply <- list()
times_datatable <- list()
times_datatable_lapply <- list()
times_tibble <- list()
times_tibble_lapply <- list()

weights_dataframe <- list()
weights_datatable <- list()
weights_tibble <- list()

# Loop on the structures
for (i in Structures_types) {
  cat("\nStrucure : ",i,"\n")
  # Loop on the structure's size
  for (j in num_elem) {
    # Both instanciation methods should return the same object
    # The set.seed() command maes all the structures having the same information
    set.seed(1)
    test <- eval(parse(text=paste("usm_",i,"_by_lapply(",j,")",sep="")))
    if (i == "dataframe") {
      weights_dataframe <- append(weights_dataframe,object.size(test))
    }
    else {
      if (i == "datatable") {
        weights_datatable <- append(weights_datatable,object.size(test))
      }
      else {
        weights_tibble <- append(weights_tibble,object.size(test))
      }
    }
    # benchmark
    name1 <- paste(i,"_by_itself",sep="")
    name2 <- paste(i,"_by_lapply",sep="")
    benchmark <- microbenchmark(name1 = eval(parse(text=paste("usm_",i,"_by_",i,"(",j,")",sep=""))),
                                name2 = eval(parse(text=paste("usm_",i,"_by_lapply(",j,")",sep=""))),
                                setup = set.seed(1),times = 10)
    
    if (is.null(time_unit)) {
       time_unit =  unit_str <- gsub(pattern = "Unit: ", x = capture.output(benchmark)[1], replacement = "")
     }
     
     current_bench_time_unit =  unit_str <- gsub(pattern = "Unit: ", x = capture.output(benchmark)[1], replacement = "")
     
     time_itself = summary(benchmark)$median[1]
     time_lapply = summary(benchmark)$median[2]
     
     if (current_bench_time_unit != time_unit) {
       index_time_unit = which(times_units == time_unit)
       index_current_bench_time_unit = which(times_units == current_bench_time_unit)
       diff = index_current_bench_time_unit - index_time_unit
       # we're starting from the hypothesis that the first unit will be the unit from the benchmark with the smallest size and a benchmark with a bigger size will take more time. We multiply by 1000 because it is the rate to pass from an unit to another.
       for (k in 1:diff) {
         time_itself <- time_itself*1000
         time_lapply <- time_lapply*1000
       }
     }
     
     if (i == "dataframe") {
       if (j == 1000) {
         times_dataframe <- time_itself
         times_dataframe_lapply <- time_lapply
       }
       else {
         times_dataframe <- append(times_dataframe,time_itself)
         times_dataframe_lapply <- append(times_dataframe_lapply,time_lapply)
       }
     }
     else {
       if (i == "datatable") {
         if (j == 1000) {
           times_datatable <- time_itself
           times_datatable_lapply <- time_lapply
         }
         else {
           times_datatable <- append(times_datatable,time_itself)
           times_datatable_lapply <- append(times_datatable_lapply,time_lapply)
         }
       }
       else {
         if (j == 1000) {
            times_tibble <- time_itself
            times_tibble_lapply <- time_lapply
         }
         else {
            times_tibble <- append(times_tibble,time_itself)
            times_tibble_lapply <- append(times_tibble_lapply,time_lapply)
         }
       }
     }
     
     if (j == 100000) {
       print(ggplot2::autoplot(benchmark))
     }
  }
  time_ref <- paste("Time_log10_",time_unit,sep="")
  if (i == "dataframe") {
    df_df <- data.frame(Usms = num_elem, time_ref = log10(times_dataframe), type = "Dataframe itself")
    df_df_lapply <- data.frame(Usms = num_elem, time_ref = log10(times_dataframe_lapply), type = "Dataframe lapply")
    final <- rbind(df_df,df_df_lapply)
    ggplot(final)+geom_line(aes(Usms,time_ref,colour=type))
  }
  else {
    if (i == "datatable") {
      df_dt <- data.frame(Usms = num_elem, time_ref = log10(times_datatable), type = "Datatable itself")
      df_dt_lapply <- data.frame(Usms = num_elem, time_ref = log10(times_datatable_lapply), type = "Datatable lapply")
      final <- rbind(df_dataframe,df_df_lapply)
      ggplot(final)+geom_line(aes(Usms,time_ref,colour=type))
    }
    else {
      df_tb <- data.frame(Usms = num_elem, time_ref = log10(times_tibble), type = "Tibble itself")
      df_tb_lapply <- data.frame(Usms = num_elem, time_ref = log10(times_tibble_lapply), type = "Tibble lapply")
      final <- rbind(df_dataframe,df_df_lapply)
      ggplot(final)+geom_line(aes(Usms,time_ref,colour=type))
    }
  }
}

df_dataframe_weights <- data.frame(Usms = num_elem, Weights = weights_dataframe, type = "Dataframe")
df_datatable_weights <- data.frame(Usms = num_elem, Weights = weights_datatable, type = "Datatable")
df_tibble_weights <- data.frame(Usms = num_elem, Weights = weights_tibble, type = "Tibble")
final_weights <- rbind(df_dataframe_weights,df_datatable_weights,df_tibble_weights)
ggplot(final_weights)+geom_line(aes(Usms,Weights,colour=type))

df_dataframe_time <- data.frame(Usms = num_elem, time_ref = log10(times_dataframe_lapply), type = "Dataframe")
df_datatable_time <- data.frame(Usms = num_elem, time_ref = log10(times_datatable_lapply), type = "Datatable")
df_tibble_time <- data.frame(Usms = num_elem, time_ref = log10(times_tibble_lapply), type = "Tibble")
final_time <- rbind(df_dataframe_time,df_datatable_time,df_tibble_time)
ggplot(final_time)+geom_line(aes(Usms,time_ref,colour=type))
```

## II.B Most suitable datatype structure

With the previous results, we now try to find the most suitable datatype.

```{r best datatype structure, eval=FALSE}

# list which contains the structures' types
Structures_types <- c("list","class","dataframe","datatable","tibble")
# list which contains the differents instanciations methods
Instanciation_methods <- c("Directly","Vector","Lapply")
Instanciation_methods_bis <- c("Directly","By_Df_by_Vector","By_Df_by_Lapply","By_df_directly")
Instanciation_methods_ter <- c("Vector","Lapply")

# used for global recap plot
all_weight <- list() # used to store the minimum weights for all the instances
all_time <- list() # used to store the minimum generation time for all the instances

# main loop
for (i in num_elem) {
  
  cat("\nNumber of elements : ",i,"\n")
  
  # loop_weight will be used to store the min weight among the instances' weights in the j-th loop
  loop_weight <- list()
  # loop_time is the same as loop_weight but it will store the min generation time
  loop_time <- list()

  # loop that will take vector_method and lapply_method together for the same structure because
  # list_vector and list_lapply have the same size
  for (j in 1:length(Structures_types)) {
    
      cat(Structures_types[j],"\n")
      
      if (j < 3) {
       
        test <- eval(parse(text=paste("list_of_usm_",Structures_types[j],"_by_vector(",i,")",
                                      sep="")))
        instance_weight <- object.size(test)
      
        test <- eval(parse(text=paste("list_of_usm_",Structures_types[j],"_by_lapply(",i,")",
                                      sep="")))
        instance_weight <- append(instance_weight,object.size(test))
      
        plot_weight <- data.frame(Instanciation_modes = Instanciation_methods_ter,
                                  weights = instance_weight)
      
        graph <- ggplot(data = plot_weight,aes(x =Instanciation_modes, y=weights)) +
          geom_bar(stat = "identity")
        print(graph + ggtitle(sprintf("%d %s %s",i," elements ",Structures_types[j])))
      
        benchmark <- microbenchmark(Vector = eval(parse(text=paste("list_of_usm_",
                                                                   Structures_types[j],
                                                                   "_by_vector(",i,")",sep=""))),
                                    Lapply= eval(parse(text=paste("list_of_usm_",
                                                                  Structures_types[j],
                                                                  "_by_lapply(",i,")",sep=""))),
                                    times = 3)
        
        plot_time <- data.frame(Instanciation_modes = Instanciation_methods_ter,
                                mean_times = log10(summary(benchmark)$mean))
      
        graph <- ggplot(data = plot_time,aes(x = Instanciation_modes, y=mean_times)) +
          geom_bar(stat = "identity")
        print(graph + ggtitle(sprintf("%d %s %s",i," elements ",Structures_types[j])))
      
        print(ggplot2::autoplot(benchmark) + ggtitle(sprintf("%s %d %s %s","Duration tests for a ",
                                                       i," elements ",Structures_types[j])))
        
        if (length(loop_weight) == 0) {
          loop_weight <- min(instance_weight)
          loop_time <- min(summary(benchmark)$mean)
        }
        else {
          loop_weight <- append(loop_weight,min(instance_weight))
          loop_time <- append(loop_time,min(summary(benchmark)$mean))
        }
        
        if (length(all_weight) == 0) {
          all_weight <- min(instance_weight)
          all_time <- min(summary(benchmark)$mean)
        }
        else {
          all_weight <- append(all_weight,min(instance_weight))
          all_time <- append(all_time,min(summary(benchmark)$mean))
        }
        
      }
      else {
        
        if (j == 3) {  # Dataframe  
          
          test <- eval(parse(text=paste("usm_",Structures_types[j],"_by_vector(",i,")",
                                        sep="")))
          instance_weight <- object.size(test)
        
          test <- eval(parse(text=paste("usm_",Structures_types[j],"_by_lapply(",i,")",
                                        sep="")))
          instance_weight <- append(instance_weight,object.size(test))
          
          plot_weight <- data.frame(Instanciation_modes = Instanciation_methods_ter,
                                  weights = instance_weight)
      
          graph <- ggplot(data = plot_weight,aes(x =Instanciation_modes, y=weights)) +
            geom_bar(stat = "identity")
          print(graph + ggtitle(sprintf("%d %s %s",i," elements ",Structures_types[j])))
        
          benchmark <- microbenchmark(Vector=eval(parse(text=paste("usm_",Structures_types[j],
                                                                   "_by_vector(",i,")",sep=""))),
                                      Lapply=eval(parse(text=paste("usm_",Structures_types[j],
                                                                   "_by_lapply(",i,")",sep=""))),
                                      times = 3)
          
          plot_time <- data.frame(Instanciation_modes = Instanciation_methods_ter,
                                  mean_times = log10(summary(benchmark)$mean))
        
          graph <- ggplot(data = plot_time,aes(x = Instanciation_modes, y=mean_times)) +
            geom_bar(stat = "identity")
          print(graph + ggtitle(sprintf("%d %s %s",i," elements ",Structures_types[j])))
        
          print(ggplot2::autoplot(benchmark) + ggtitle(sprintf("%s %d %s %s","Duration tests for a",
                                                         i," elements ",Structures_types[j])))
          
          if (length(loop_weight) == 0) {
            loop_weight <- min(instance_weight)
            loop_time <- min(summary(benchmark)$mean)
          }
          else {
            loop_weight <- append(loop_weight,min(instance_weight))
            loop_time <- append(loop_time,min(summary(benchmark)$mean))
          }
          
          if (length(all_weight) == 0) {
            all_weight <- min(instance_weight)
            all_time <- min(summary(benchmark)$mean)
          }
          else {
            all_weight <- append(all_weight,min(instance_weight))
            all_time <- append(all_time,min(summary(benchmark)$mean))
          }
            
        }
        else { # DataTable & tibble
          
          test <- eval(parse(text=paste("usm_",Structures_types[j],
                                        "_by_usm_dataframe_by_vector(",i,")",sep="")))
          instance_weight <- object.size(test)
          
          test <- eval(parse(text=paste("usm_",Structures_types[j],
                                        "_by_usm_dataframe_by_lapply(",i,")",sep="")))
          instance_weight <- append(instance_weight,object.size(test))
          
          plot_weight <- data.frame(Instanciation_modes = Instanciation_methods_ter,
                                  weights = instance_weight)
      
          graph <- ggplot(data = plot_weight,aes(x =Instanciation_modes, y=weights)) +
            geom_bar(stat = "identity")
          print(graph + ggtitle(sprintf("%d %s %s",i," elements ",Structures_types[j])))
        
          benchmark <- microbenchmark(Vector=eval(parse(text=paste("usm_",Structures_types[j],
                                        "_by_usm_dataframe_by_vector(",i,")",sep=""))),
                                      Lapply=eval(parse(text=paste("usm_",Structures_types[j],
                                        "_by_usm_dataframe_by_lapply(",i,")",sep=""))),
                                      times = 3)
          
          plot_time <- data.frame(Instanciation_modes = Instanciation_methods_ter,
                                  mean_times = log10(summary(benchmark)$mean))
        
          graph <- ggplot(data = plot_time,aes(x = Instanciation_modes, y=mean_times)) +
            geom_bar(stat = "identity")
          print(graph + ggtitle(sprintf("%d %s %s",i," elements ",Structures_types[j])))
        
          print(ggplot2::autoplot(benchmark) + ggtitle(sprintf("%s %d %s %s","Duration tests for a ",
                                                         i," elements ",Structures_types[j])))
          
          if (length(loop_weight) == 0) {
            loop_weight <- min(instance_weight)
            loop_time <- min(summary(benchmark)$mean)
          }
          else {
            loop_weight <- append(loop_weight,min(instance_weight))
            loop_time <- append(loop_time,min(summary(benchmark)$mean))
          }
          
          if (length(all_weight) == 0) {
            all_weight <- min(instance_weight)
            all_time <- min(summary(benchmark)$mean)
          }
          else {
            all_weight <- append(all_weight,min(instance_weight))
            all_time <- append(all_time,min(summary(benchmark)$mean))
          }
        }
      }
  }
  # Recap for all the instances at the same size
  plot_weight_recap <- data.frame(structures = Structures_types,weight_log10 = log10(loop_weight))
  
  graph_weight_recap <- ggplot(data = plot_weight_recap,aes(x = structures, y=weight_log10)) +
    geom_bar(stat = "identity")
  print(graph_weight_recap + ggtitle(sprintf("%s %d %s","Weight recap for ",i,
                                             " elements structures")))
  
  plot_time_recap <- data.frame(structures = Structures_types,times_log10 = log10(loop_time))
  
  graph_time_recap <- ggplot(data = plot_time_recap,aes(x = structures, y=times_log10)) +
    geom_bar(stat = "identity")
  print(graph_time_recap + ggtitle(sprintf("%s %d %s","time recap for ",i,
                                           " elements Structures")))
}

# GLOBAL Recap

structures <- rep(Structures_types,3)
times_log10 <- log10(all_time)
weight_log10 <- log10(all_weight)
size <- c(rep(num_elem[1],5),rep(num_elem[2],5),rep(num_elem[3],5))
size <- as.character(size)

global_plot_weight_recap <- data.frame(structures,weight_log10,size)

global_graph_weight_recap <- ggplot(data = global_plot_weight_recap,aes(x = size, y=weight_log10,
                                                                        fill = structures)) + 
  geom_bar(position = "dodge", stat = "identity")
global_graph_weight_recap + ggtitle(sprintf("%s","weight recap graph"))

global_plot_time_recap <- data.frame(structures,times_log10,size)

global_graph_time_recap <- ggplot(data = global_plot_time_recap,aes(x = size, y=times_log10,
                                                                    fill = structures)) +
  geom_bar(position = "dodge",stat = "identity")
global_graph_time_recap + ggtitle(sprintf("%s"," time recap graph"))
```
  
We can conclude that the most suitable datatype is one of DataFrame,DataTable and Tibble.

# III. Extraction

We're now moving to Usm sublist extraction test part. For this part, we tested two ways of extracting usms sublist, by random usm name and criteria research. Each tests was tested in several ways.

## III.A Random extraction by Usm name

In these tests we're randomly picking and extracting usm names.

```{r random extraction s,eval=FALSE}

li <- list_of_usm_list_by_vector(100)
cla <- list_of_usm_class_by_vector(100)
df <- usm_dataframe_by_vector(100)
dt <- usm_datatable_by_usm_dataframe_by_vector(100)
tb <- usm_tibble_by_usm_dataframe_by_vector(100)

benchmark <- microbenchmark(random_extract_for_usm_list_class(50,li),
                            random_extract_for_usm_list_class(50,cla),
                            map_random_extract(50,li),map_random_extract(50,cla),
                            random_extract_for_usm_df_dt_tb(50,df),random_extract_for_usm_df_dt_tb(50,dt),
                            random_extract_for_usm_df_dt_tb(50,tb),times = 100)

benchmark

plot_time <- data.frame(Instanciation_modes = c("list","class","map list","map class","dataframe","datatable",
                                                "tibble"),
                                  mean_times = log10(summary(benchmark)$mean))

graph <- ggplot(data = plot_time,aes(x = Instanciation_modes, y=mean_times)) +
            geom_bar(stat = "identity")

graph

ggplot2::autoplot(benchmark)
```

## III.B Extraction by criteria

In these tests we're selectionning a usm's criteria and extracting the usm in which the criteria is present.

```{r criteria extraction s,eval=FALSE}

li <- list_of_usm_list_by_vector(100)
cla <- list_of_usm_class_by_vector(100)
df <- usm_dataframe_by_vector(100)
dt <- usm_datatable_by_usm_dataframe_by_vector(100)
tb <- usm_tibble_by_usm_dataframe_by_vector(100)

benchmark <- microbenchmark(criteria_extract_for_usm_list_class(li,"ground_name","sol_canne"),
                            criteria_extract_for_usm_list_class(cla,"ground_name","sol_canne"),
                            map_criteria_extract(li,"ground_name","sol_canne"),
                            map_criteria_extract(cla,"ground_name","sol_canne"),
                            criteria_extract_for_usm_df_dt_tb(df,"ground_name","sol_canne"),
                            criteria_extract_for_usm_df_dt_tb(dt,"ground_name","sol_canne"),
                            criteria_extract_for_usm_df_dt_tb(tb,"ground_name","sol_canne"),
                            times = 100)

benchmark

plot_time <- data.frame(Instanciation_modes = c("list","class","map list","map class","dataframe","datatable",
                                                "tibble"),
                                  mean_times = log10(summary(benchmark)$mean))

graph <- ggplot(data = plot_time,aes(x = Instanciation_modes, y=mean_times)) +
            geom_bar(stat = "identity")

graph

ggplot2::autoplot(benchmark)
```