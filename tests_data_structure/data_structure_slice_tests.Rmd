---
title: "Data Structure Slice Tests"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

This document is composed of some tests made in order to try differents ways to access data from
differents structure types and to choose the simplier way to access it. Also, these tests 
represent way to extract sub-list of usms.

```{r header,message = FALSE, warning = FALSE}
source("data_structure_functions.R")

########################### LIBRARIES & GLOBAL VARIABLES/FUNCTIONs ################################
library(tibble)
library(data.table)
library(dplyr)
```

```{r constructors}

# function that creates a 300 elem long list of elements that can be modified
num_list = function() {
  li <- lapply(1:3,function(i) i)
  return(li)
}

############################### LIST ##############################

# "plant dominance 1" list creation
pld_sugarCane1 = list("fplt" = "proto_sugarcane_plt.xml","ftec" = "canne_tec.xml","flai" = "null") 

# "plant dominance 2" list creation
pld_sugarCane2 = list("fplt" = "null","ftec" = "null","flai" = "null")     

# 300 elem long list which can be modified
param_list = num_list()                                                                               

# sugarCane usm creation
usm_sugarCane <- list(name = "SugarCane",date_begin = 286,date_end = 650,finit = "canne_ini.xml",
                      ground_name = "solcanne",fstation = "climcanj_sta.xml",fclim1 = "climcanj.1998",
                      fclim2 = "climcanj.1999",culturean = 0,nb_plant = 1,simulation_code = 0,
                      plant_dominance_1 = pld_sugarCane1,plant_dominance_2 = pld_sugarCane2,
                      observation_file = "file.obs",parametres_list = param_list) 

usm_potato <- list(name = "potato",date_begin = 133,date_end = 256,finit = "patate_ini.xml",
                      ground_name = "solpatate",fstation = "climcanj_sta.xml",fclim1 = "climcanj.1998",
                      fclim2 = "climcanj.1999",culturean = 0,nb_plant = 1,simulation_code = 0,
                      plant_dominance_1 = pld_sugarCane1,plant_dominance_2 = pld_sugarCane2,
                      observation_file = "file.obs",parametres_list = param_list) 

############################# CLASS ########################################

# usm class declaration
usm <- setRefClass("usm",
                   fields = list(name = "character",date_begin = "numeric",date_end = "numeric",
                                 finit = "character",ground_name = "character",fstation = "character",
                                 fclim1 = "character",fclim2 = "character",culturean = "numeric",
                                 nb_plant = "numeric",simulation_code = "numeric",
                                 plant_dominance_1 = "list",plant_dominance_2 = "list",
                                 observation_file = "character",parametres_list = "list")
)

# usm class object Sugarcane instanciation
Sugarcane <- usm(name = "SugarCane",date_begin = 286,date_end = 650,finit = "canne_ini.xml",
                 ground_name = "solcanne",fstation = "climcanj_sta.xml",fclim1 = "climcanj.1998",
                 fclim2 = "clilmcanj.1999",nb_plant = 0,simulation_code = 1,
                 plant_dominance_1 = pld_sugarCane1,plant_dominance_2 = pld_sugarCane2,
                 observation_file = "file.obs",parametres_list = param_list)

Potato <- usm(name = "potato",date_begin = 133,date_end = 256,finit = "patate_ini.xml",
                 ground_name = "solpatate",fstation = "climcanj_sta.xml",fclim1 = "climcanj.1998",
                 fclim2 = "clilmcanj.1999",nb_plant = 0,simulation_code = 1,
                 plant_dominance_1 = pld_sugarCane1,plant_dominance_2 = pld_sugarCane2,
                 observation_file = "file.obs",parametres_list = param_list)


################ DATA FRAME ################################################

# creation data frame df using list usm_sugarCane
df_sugarcane <- data.frame(usm_sugarCane)
df_potato <- data.frame(usm_potato)

############### TIBBLE #####################################################

#creation tibble tb using data frame df
tb_sugarcane <- tibble::as_tibble(df_sugarcane)
tb_potato <- tibble::as_tibble(df_potato)

############### DATA TABLE ###################
dt_sugarcane <- data.table(df_sugarcane)
dt_potato <- data.table(df_potato) 

############## TESTS #################################################################

# number of element
num_elem = 1

```

# TESTS 

```{r list}

########### LIST ############

test <- PA_vector_list_and_class(num_elem,usm_sugarCane)
test_bis <- PA_vector_list_and_class(num_elem,usm_potato)
test <- append(test,test_bis)

# we get all the name of the usms
unlist(lapply(test, function(x) x$name))

# we get the first usm
test[[1]]

# we get the first usm's name
test[[1]]$name


```


``` {r class}

########### CLASS  ############
test_class <- PA_vector_list_and_class(num_elem,Sugarcane)
test_class2 <- PA_vector_list_and_class(num_elem,Potato)
test_class <- append(test_class,test_class2)

# we get the first usm
test_class[1]

# we get the first two usms
test_class[1:2]

# we get the second usm's name
test_class[[2]]$name

# we get the parameters list's second value from the second usm
test_class[[2]]$parametres_list[[2]]
# it also works with simple square brackets '[]'

```


```{r data frame}

############# DataFrame #############

test_df <- PA_vector_Df_and_Tb(num_elem,df_sugarcane)
test_df_potato <- PA_vector_Df_and_Tb(num_elem,df_potato)
test_df <- rbind(test_df,test_df_potato)

# we get the first line which corresponds to the first usm
test_df[1]

# we get the first two lines (they are only two usm in this case)
test_df[1:2]

# we get the first column's informations
test_df[[1]]

# we get the first column's second element, it also works with double square brackets '[[]]'
test_df[[1]][2]

# we get the first usm's second element
test_df[1][[2]]

# We can also use the "dplyr" package for data frame manipulation

# we're selectionning usms where their field "name" is equal to "potato"
filter(test_df,name =="potato")

# we're selectionning all the usms' "name" and "date_begin" fields
select(test_df,name,date_begin)

# we're selectionning all the usms without their fields "name" and "date_begin"
select(test_df,-name,-date_begin)

slice(tibble::rownames_to_column(test_df),1L)

```

```{r tibble}

############ TIBBLE ###########

# on peux aussi user des noms des colonnes pour selectionner les elements voulus
test_tb <- PA_vector_Df_and_Tb(num_elem,tb_sugarcane)
test_tb_potato <- PA_vector_Df_and_Tb(num_elem,tb_potato)
test_tb <- rbind(test_tb,test_tb_potato)

# we can access tibble's datas the same way as data frame but we cal also access its by using 
# the field's name wanted

# we're getting the second usm's name
test_tb[2,name]

# we're getting the first usm's date_begin
test_tb[1,date_begin]

# furthermore, we can get a list of many elements from one to all the usms
# here, we want to get the name and begin date all of the usms
test_tb[,.(name,date_begin)]

```

All of the ways to access data for Data Frames and Tibbles can be used to access Data Tables' datas

# CONCLUSION

In the "data_structure_creation_tests" Rmd, we saw that the class structure had better results 
considering the memory weight and the speed.

Now, we see that the ways to access class' data are easy but we don't have a method to do research
on these datas like the filter method (dplyr package).

However, we can suppose that structure types like Data Frame, Tibble or Data Table can be used for
the Designs of Experiments because due to the dplyr packages and its methods we can easily search 
and get the wanted datas.

The next step is to know how to use the slice method from the dplyr package, because it's the most
important method considering the huge amount of usms we can possibly work with.
