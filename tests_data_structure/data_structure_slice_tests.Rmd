---
title: "data_structure_slice_tests"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Ce document présente les tests de manipulation, dérécupération et de modification d'usm.


```{r constructors}

source("data_structure_functions.R")

########################### LIBRARIES & GLOBAL VARIABLES/FUNCTIONs ################################
library(microbenchmark)
library(ggplot2)
library(tibble)
library(data.table)
library(dplyr)

# microbenchmark execution number
time = 100                                                                

# function that creates a 300 elem long list of elements that can be modified
num_list = function() {
  li <- lapply(1:3,function(i) i)
  return(li)
}

############################### LIST ##############################

# "plant dominance 1" list creation
pld_sugarCane1 = list("fplt" = "proto_sugarcane_plt.xml","ftec" = "canne_tec.xml","flai" = "null") 

# "plant dominance 2" list creation
pld_sugarCane2 = list("fplt" = "null","ftec" = "null","flai" = "null")     

# 300 elem long list which can be modified
param_list = num_list()                                                                               

# sugarCane usm creation
usm_sugarCane <- list(name = "SugarCane",date_begin = 286,date_end = 650,finit = "canne_ini.xml",
                      ground_name = "solcanne",fstation = "climcanj_sta.xml",fclim1 = "climcanj.1998",
                      fclim2 = "climcanj.1999",culturean = 0,nb_plant = 1,simulation_code = 0,
                      plant_dominance_1 = pld_sugarCane1,plant_dominance_2 = pld_sugarCane2,
                      observation_file = "file.obs",parametres_list = param_list) 

usm_potato <- list(name = "potato",date_begin = 133,date_end = 256,finit = "patate_ini.xml",
                      ground_name = "solpatate",fstation = "climcanj_sta.xml",fclim1 = "climcanj.1998",
                      fclim2 = "climcanj.1999",culturean = 0,nb_plant = 1,simulation_code = 0,
                      plant_dominance_1 = pld_sugarCane1,plant_dominance_2 = pld_sugarCane2,
                      observation_file = "file.obs",parametres_list = param_list) 

############################# CLASS ########################################

# usm class declaration
usm <- setRefClass("usm",
                   fields = list(name = "character",date_begin = "numeric",date_end = "numeric",
                                 finit = "character",ground_name = "character",fstation = "character",
                                 fclim1 = "character",fclim2 = "character",culturean = "numeric",
                                 nb_plant = "numeric",simulation_code = "numeric",
                                 plant_dominance_1 = "list",plant_dominance_2 = "list",
                                 observation_file = "character",parametres_list = "list")
)

# usm class object Sugarcane instanciation
Sugarcane <- usm(name = "SugarCane",date_begin = 286,date_end = 650,finit = "canne_ini.xml",
                 ground_name = "solcanne",fstation = "climcanj_sta.xml",fclim1 = "climcanj.1998",
                 fclim2 = "clilmcanj.1999",nb_plant = 0,simulation_code = 1,
                 plant_dominance_1 = pld_sugarCane1,plant_dominance_2 = pld_sugarCane2,
                 observation_file = "file.obs",parametres_list = param_list)

Potato <- usm(name = "potato",date_begin = 133,date_end = 256,finit = "patate_ini.xml",
                 ground_name = "solpatate",fstation = "climcanj_sta.xml",fclim1 = "climcanj.1998",
                 fclim2 = "clilmcanj.1999",nb_plant = 0,simulation_code = 1,
                 plant_dominance_1 = pld_sugarCane1,plant_dominance_2 = pld_sugarCane2,
                 observation_file = "file.obs",parametres_list = param_list)


################ DATA FRAME ################################################

# creation data frame df using list usm_sugarCane
df_sugarcane <- data.frame(usm_sugarCane)
df_potato <- data.frame(usm_potato)

############### TIBBLE #####################################################

#creation tibble tb using data frame df
tb_sugarcane <- tibble::as_tibble(df_sugarcane)
tb_potato <- tibble::as_tibble(df_potato)

############### DATA TABLE ###################
dt_sugarcane <- data.table(df_sugarcane)
dt_potato <- data.table(df_potato) 

############## TESTS #################################################################

# number of element
num_elem = 1

```

# TESTS 

```{r list}

########### LIST #############

test <- NPA_list(num_elem,usm_sugarCane)
test_bis <- NPA_list(num_elem,usm_potato)
test <- append(test,test_bis)
# on rÃ©cupÃ¨re la premiÃ¨re usm (15 elements dans une usm)
test[1:15]
# on rÃ©cupÃ¨re le nom de la premiÃ¨re usm
test[1:15]$name
# on recupÃ¨re les noms des usms directement avec leurs indices
test[1]
test[16]
# on recupere tous les noms de la liste
test$name
# mais cela ne fonctionne pas et ne retourne que le premier

```


``` {r class}

########### CLASS  ############
test_class <- NPA_list(num_elem,Sugarcane)
test_class2 <- NPA_list(num_elem,Potato)
test_class <- append(test_class,test_class2)
# on recupere les infos de la premiere usm
test_class[1]
# on rÃ©cupÃ¨re le nom de la seconde usm
test_class[[2]]$name
# on recupere un valeur de la liste de parametres de la seconde usm
test_class[[2]]$parametres_list[[2]]
# cela fonctionne avec simple crochet aussi

```


```{r data frame}

############# DataFrame #############

test_df <- PA_vector_Df_and_Tb(num_elem,df_sugarcane)
test_df_potato <- PA_vector_Df_and_Tb(num_elem,df_potato)
test_df <- rbind(test_df,test_df_potato)
# retourne la premiere ligne
test_df[1]
# retourne les deux premières lignes
test_df[1:2]
# retourne toutes les informations dans la premiÃ¨re colonne
test_df[[1]]
# retourne le second element dans la colonne 1, fonctionne aussi avec double crochets
test_df[[1]][2]
# retourne le deuxiÃ¨me element de la premiÃ¨re ligne
test_df[1][[2]]

# On peut aussi s'aider du package "dplyr" en qui concerne la manipulation de data frame

# on selectionne les les lignes du tableau dont le champ "name" est égal à "potato"
filter(test_df,name =="potato")
# on selectionne les champs "name" et "date_begin"
select(test_df,name,date_begin)
# on exclut les champs "name" et "date_begin"
select(test_df,-name,-date_begin)

```

```{r tibble}

############ TIBBLE ###########

# on peux aussi user des noms des colonnes pour selectionner les elements voulus
test_tb <- PA_vector_Df_and_Tb(num_elem,tb_sugarcane)
test_tb_potato <- PA_vector_Df_and_Tb(num_elem,tb_potato)
test_tb <- rbind(test_tb,test_tb_potato)

# on peux accéder aux valeurs de la même façon que pour les data frame et l'on peut aussi y accéder
# en passant le nom du champ voulu

# on veut le nom de la seconde ligne
test_tb[2,name]
# on veut la date de début de la première ligne
test_tb[1,date_begin]

# de plus, peut meme recupérer plusieurs elements d'une ou plusieurs lignes
# par exemple, on veut récupérer le nom et la deta de debut de toutes les lignes
test_tb[,.(name,date_begin)]

```

On peut bien sur appliquer aussi cela à la structure data Table

# CONCLUSION

Il me reste à pourvoir utiliser la fonction slice du package dplyr sinon les types de structure tels
que data frame, tibble et data table semblent les plus aptes à une manipulation faciles des données
